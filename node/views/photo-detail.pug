doctype html
html
  head
    title #{photo.file_name}
    meta(charset="utf-8")
    script(src="https://cdn.tailwindcss.com")

  body(class="bg-gray-100 min-h-screen p-6")

    a(href="/", class="text-blue-600 block mb-4") â† Back

    div(class="max-w-6xl mx-auto bg-white shadow p-6 rounded-lg flex flex-col md:flex-row gap-8")

      // LEFT: main photo & faces
      div(class="flex-1")
        img(src=`${photo.thumb_base64}`, class="w-full rounded-lg shadow mb-6")

        if faces.length > 0
          h2(class="text-lg font-semibold mb-3") Faces in this Photo

          div(class="flex flex-wrap gap-4")
            each f in faces
              .border.rounded-lg.shadow.p-2.bg-white
                img(class="w-24 h-24 object-cover rounded", src=`data:image/jpeg;base64,${f.crop_base64}`)
                if f.person_name
                  p(class="text-xs text-green-700 mt-1 font-medium") #{f.person_name}
                else if f.cluster_id
                  p(class="text-xs text-gray-500 mt-1") Cluster #{f.cluster_id}
                else
                  p(class="text-xs text-gray-400 mt-1") Unknown

      // RIGHT: metadata panel
      div(class="w-full md:w-80 space-y-6")

        // People section
        if faces.some(f => f.person_name)
          div(class="border rounded-lg p-4 bg-white shadow")
            h3(class="text-lg font-semibold mb-2") People Recognized
            ul(class="list-disc list-inside text-sm")
              each f in faces
                if f.person_name
                  li(class="font-medium") #{f.person_name}

        // Description
        if photo.annotation && photo.annotation.description
          div(class="border rounded-lg p-4 bg-white shadow")
            h3(class="text-lg font-semibold mb-2") Description
            p(class="text-sm text-gray-700") #{photo.annotation.description}

        // Tags
        if photo.annotation && photo.annotation.tags && photo.annotation.tags.length
          div(class="border rounded-lg p-4 bg-white shadow")
            h3(class="text-lg font-semibold mb-2") Tags
            div(class="flex flex-wrap gap-2")
              each t in photo.annotation.tags
                span(class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded") #{t}

        // EXIF metadata summary
        div(class="border rounded-lg p-4 bg-white shadow")
          h3(class="text-lg font-semibold mb-2") Metadata
          ul(class="text-sm text-gray-700 space-y-1")
            if photo.taken_at
              li Taken at: #{photo.taken_at}
            if photo.camera_make
              li Camera: #{photo.camera_make} #{photo.camera_model}
            if photo.lens
              li Lens: #{photo.lens}
            if photo.focal_length
              li Focal length: #{photo.focal_length}
            if photo.iso
              li ISO: #{photo.iso}
            if photo.exposure_time
              li Exposure: #{photo.exposure_time}
            if photo.aperture
              li Aperture: #{photo.aperture}

        // Debug JSON (optional)
        details(class="mt-4")
          summary(class="cursor-pointer text-sm text-gray-600") Debug JSON
          pre(class="bg-gray-100 p-4 mt-2 rounded text-xs overflow-x-auto")
            | #{JSON.stringify(photo, null, 2)}
            | #{JSON.stringify(faces, null, 2)}
