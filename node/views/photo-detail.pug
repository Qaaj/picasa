doctype html

include components/photo-full.pug
//- Full photo component (photo + detected faces list)

html
  head
    title #{photo.file_name}
    meta(charset="utf-8")
    script(src="https://cdn.tailwindcss.com")

  body(class="bg-gray-100 min-h-screen p-6")

    a(href="/", class="text-blue-600 block mb-4") ← Back
    div(class="max-w-6xl mx-auto bg-white shadow p-6 rounded-lg flex flex-col md:flex-row gap-8")

      +photoFull(photo, faces)

      // RIGHT: metadata panel
      div(class="w-full md:w-80 space-y-6")

        // People section
        if faces.some(f => f.person_name)
          div(class="border rounded-lg p-4 bg-white shadow")
            h3(class="text-lg font-semibold mb-2") People Recognized
            ul(class="list-disc list-inside text-sm")
              each f in faces
                if f.person_name
                  li(class="font-medium") #{f.person_name}

        // Description
        if photo.annotation && photo.annotation.description
          div(class="border rounded-lg p-4 bg-white shadow")
            h3(class="text-lg font-semibold mb-2") Description
            p(class="text-sm text-gray-700") #{photo.annotation.description}

        // Tags
        if photo.annotation && photo.annotation.tags && photo.annotation.tags.length
          div(class="border rounded-lg p-4 bg-white shadow")
            h3(class="text-lg font-semibold mb-2") Tags
            div(class="flex flex-wrap gap-2")
                each tag in photo.annotation.tags
                    a(
                        href=`/tags/${tag}`
                        class="inline-block px-2 py-1 bg-gray-200 rounded-full mr-2 mb-2 text-sm hover:bg-gray-300"
                    ) #{tag}
        // Related Photos
        if related && related.length > 0
            .mt-6
                h3(class="text-lg font-semibold mb-2") Similar Photos
                .grid(class="grid-cols-3 gap-3")
                  each r in related
                      a(href=`/photo/${r.id}`, class="block border rounded overflow-hidden hover:shadow")
                          img(src=r.thumb_base64 class="w-full h-24 object-cover")
        // EXIF metadata summary
        div(class="border rounded-lg p-4 bg-white shadow")
          h3(class="text-lg font-semibold mb-2") Metadata
          ul(class="text-sm text-gray-700 space-y-1")
            if photo.taken_at
              li Taken at: #{photo.taken_at}
            if photo.camera_make
              li Camera: #{photo.camera_make} #{photo.camera_model}
            if photo.lens
              li Lens: #{photo.lens}
            if photo.focal_length
              li Focal length: #{photo.focal_length}
            if photo.iso
              li ISO: #{photo.iso}
            if photo.exposure_time
              li Exposure: #{photo.exposure_time}
            if photo.aperture
              li Aperture: #{photo.aperture}

        a(
            href=`/photo/full/${photo.id}/${photo.file_name}`
            target="_blank"
            class="text-blue-600 underline text-sm mt-2 inline-block"
        ) Download
            // Folder navigation
        div(class="mb-4")
            a(
                href=`/folder/from-photo/${photo.id}`
                class="inline-block px-3 py-1 bg-blue-50 text-blue-700 border border-blue-200 rounded hover:bg-blue-100 text-sm"
            ) View all photos in this folder →

        // Debug JSON (optional)
        details(class="mt-4")
          summary(class="cursor-pointer text-sm text-gray-600") Debug JSON
          pre(class="bg-gray-100 p-4 mt-2 rounded text-xs overflow-x-auto")
            | #{JSON.stringify(photo, null, 2)}
            | #{JSON.stringify(faces, null, 2)}
